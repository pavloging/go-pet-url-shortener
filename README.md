# REST API сервис на Go

Что включает в себя этот проект?
- Взаимодейстие и разработка REST API
- Обращение к бд - SQL
- Router - go-chi/chi
- Логирование - slog
- Тесты - Unit (тесты обработчиков), Функциональные тесты
- CI/CD - Workflow GitHub (CI) и отправка на сервер (CD)

## Структура проекта:
- cmd папка - внутри cmd лежат команды для взаимодействия с приложением (запуск и т.д.)
- config - папка по настройки параметров для нашего приложения
- internal - в этой папке располагается код, который НЕ должен быть доступениз других модулей (похоже на приватное хранилище)

## Важный момент!
**В реальных репозиториях файл `.env` НЕЛЬЗЯ пушить в открытый доступ на GitHub.** Поэтому я создал в корне проекта `example.env` в целях деменстрации полей, которые записаны в `.env`. Файл `example.env` будет в открытом доступе, поэтому не заполняйте его паролями и приватной информацией, он лишь нужен для деменстрации ключей которые есть в приложении, чтобы следующий программист мог вставить свои приватные данные (пароль от базы например) и так же пользоваться приложением.

- Что вам делать?
Вам нужно создать в корне проекта файл с названием: `.gitignore` и в нем написать - `.env`

- Зачем это делать?
Пути которые прописаны в `.gitignore` не будут видны Git, это сделано в целях безопастности, чтобы файлы с паролями не отправлять в открытый доступ

## Небольшой конспект видео:
- **Хорошая практика:** Приставка Must в функциях обычно используется, когда вместо возврата ошибки будет вызывать панику (Автор делает так при инициализации конфига)

- **Хорошая практика:** Удалять fmt с конфигом, так как в логи может залететь пароль в открытом виде и злоумышленик может ними воспользоваться

## Возможные ошибки:

### Если не работает `go get github.com/ilyakaznacheev/cleanenv`
Сначала инициализаируйте go.mod командной `go mod init url-shortener` и потом устанавливайте библиотеку

### Ошибка: CONFIG_PATH is not set
Автор хочет чтобы мы указывали путь до файла в теринале при каждом запуске. Но мы воспользуемся другим способом:
1. Создайте файл в корне проекта .env
2. Пришите в этот файл: CONFIG_PATH=./config/local.yaml
3. Добавьте библиотку для удобной работы с .env: go get github.com/joho/godotenv 
4. Примените библиотеку:
```go
func MustLoad() *Config {
	err := godotenv.Load()
	if err != nil {
		log.Fatal("Error loading .env file")
	}

	configPath := os.Getenv("CONFIG_PATH")
	if configPath == "" {
		log.Fatal("CONFIG_PATH is not set")
	}

    // ...
```

### Ошибка: cannot read config: field
Переходим в config -> local.yaml и добавляем user и password
Например файл получиться:
```yaml
env: "local" # local, dev, prod
storage_path: "./storage/storage.db"
http_server:
  address: "localhost:8082"
  timeout: 4s
  idle_timeout: 60s
  user: 123
  password: 123
```